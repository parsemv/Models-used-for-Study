import onnxruntime as ort
import numpy as np
from PIL import Image

def preprocess_image(image_path):
    img = Image.open(image_path).resize((640, 640))  # your model input size
    img_data = np.array(img).astype('float32')
    img_data = img_data.transpose(2, 0, 1)  # HWC to CHW
    img_data = img_data / 255.0  # normalize if needed
    img_data = np.expand_dims(img_data, axis=0)  # batch dim
    return img_data

def run_inference(onnx_path, image_path):
    session = ort.InferenceSession(onnx_path)
    input_name = session.get_inputs()[0].name

    img_data = preprocess_image(image_path)
    outputs = session.run(None, {input_name: img_data})

    print("Model outputs:", outputs)

if __name__ == "__main__":
    onnx_model = "best.onnx"
    test_image = "test.jpg"  # Provide a sample test image
    run_inference(onnx_model, test_image)
